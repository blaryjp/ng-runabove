/*! ngRunabove v0.0.1 by Jean-Philippe Blary (@blary_jp) - https://github.com/blaryjp/ng-runabove - License MIT */
angular.module("ngRunabove",[]),angular.module("ngRunabove").provider("Runabove",function(){"use strict";var a="https://manager.runabove.com/api/1.0",b=[{method:"GET",path:"/*"},{method:"POST",path:"/*"},{method:"PUT",path:"/*"},{method:"DELETE",path:"/*"}],c={ak:"",as:"",ck:""};this.setBasePath=function(b){a=b},this.setAppKey=function(a){c.ak=a},this.setAppSecret=function(a){c.as=a},this.setConsumerKey=function(a){c.ck=a,localStorage.setItem("runabove-ck",a)},this.setAccessRules=function(a){b=a},this.$get=["$http","$q",function(d,e){function f(e){c.ck&&(localStorage.removeItem("runabove-ck"),c.ck=null),d({method:"POST",url:a+"/auth/credential",headers:{"X-RA-Application":c.ak},data:{accessRules:b,redirection:e}}).then(function(a){c.ck=a.data.consumerKey,localStorage.setItem("runabove-ck",c.ck),window.location=a.data.validationUrl})}function g(){return c.ck?l().then(function(b){return d({method:"POST",url:a+"/auth/logout",headers:n({method:"POST",url:a+"/auth/logout",body:"",diff:b})}).then(function(){localStorage.removeItem("runabove-ck"),c.ck=null},function(){localStorage.removeItem("runabove-ck"),c.ck=null})}):e.reject({errorCode:"NOT_CREDENTIAL",message:"You're not logged."})}function h(b){return c.ck||b.noAuthentication?l().then(function(c){return b.url=a+b.url,b.params&&~b.url.indexOf("{")&&angular.forEach(b.params,function(a,c){new RegExp("{"+c+"}").test(b.url)&&(b.url=b.url.replace("{"+c+"}",a),delete b.params[c])}),b.headers=b.noAuthentication?n():n({method:b.method,url:b.url,body:b.body||"",diff:c}),d(b).then(function(a){return a.data})}):e.reject({errorCode:"NOT_CREDENTIAL",message:"You're not logged."})}function i(b){return d({method:"GET",url:a+b,cache:!0,headers:n()}).then(function(a){return a.data})}function j(a,b){return i(a).then(function(a){return b?a.models[b]?a.models[b]:e.reject({errorCode:"NOT_FOUND",message:"Schema not found."}):a.models})}function k(){return!!c.ck}function l(){return d({method:"GET",url:a+"/time",cache:!0,headers:n()}).then(function(a){return Math.floor(Date.now()/1e3)-a.data})}function m(a){return"$1$"+o([c.as,c.ck,a.method,a.url,a.body,a.diff].join("+"))}function n(a){if(a){var b=(Math.floor(Date.now()/1e3)-a.diff).toString();return{"Content-Type":"application/json;charset=utf-8","X-RA-Application":c.ak,"X-RA-Consumer":c.ck,"X-RA-Timestamp":b,"X-RA-Signature":m({method:a.method,url:a.url,body:a.body,diff:b})}}return{"Content-Type":"application/json;charset=utf-8"}}function o(a){function b(a,b){var c=a<<b|a>>>32-b;return c}function c(a){var b,c,d="";for(b=7;b>=0;b--)c=a>>>4*b&15,d+=c.toString(16);return d}function d(a){a=a.replace(/\r\n/g,"\n");for(var b="",c=0;c<a.length;c++){var d=a.charCodeAt(c);128>d?b+=String.fromCharCode(d):d>127&&2048>d?(b+=String.fromCharCode(d>>6|192),b+=String.fromCharCode(63&d|128)):(b+=String.fromCharCode(d>>12|224),b+=String.fromCharCode(d>>6&63|128),b+=String.fromCharCode(63&d|128))}return b}var e,f,g,h,i,j,k,l,m,n=new Array(80),o=1732584193,p=4023233417,q=2562383102,r=271733878,s=3285377520;a=d(a);var t=a.length,u=new Array;for(f=0;t-3>f;f+=4)g=a.charCodeAt(f)<<24|a.charCodeAt(f+1)<<16|a.charCodeAt(f+2)<<8|a.charCodeAt(f+3),u.push(g);switch(t%4){case 0:f=2147483648;break;case 1:f=a.charCodeAt(t-1)<<24|8388608;break;case 2:f=a.charCodeAt(t-2)<<24|a.charCodeAt(t-1)<<16|32768;break;case 3:f=a.charCodeAt(t-3)<<24|a.charCodeAt(t-2)<<16|a.charCodeAt(t-1)<<8|128}for(u.push(f);u.length%16!=14;)u.push(0);for(u.push(t>>>29),u.push(t<<3&4294967295),e=0;e<u.length;e+=16){for(f=0;16>f;f++)n[f]=u[e+f];for(f=16;79>=f;f++)n[f]=b(n[f-3]^n[f-8]^n[f-14]^n[f-16],1);for(h=o,i=p,j=q,k=r,l=s,f=0;19>=f;f++)m=b(h,5)+(i&j|~i&k)+l+n[f]+1518500249&4294967295,l=k,k=j,j=b(i,30),i=h,h=m;for(f=20;39>=f;f++)m=b(h,5)+(i^j^k)+l+n[f]+1859775393&4294967295,l=k,k=j,j=b(i,30),i=h,h=m;for(f=40;59>=f;f++)m=b(h,5)+(i&j|i&k|j&k)+l+n[f]+2400959708&4294967295,l=k,k=j,j=b(i,30),i=h,h=m;for(f=60;79>=f;f++)m=b(h,5)+(i^j^k)+l+n[f]+3395469782&4294967295,l=k,k=j,j=b(i,30),i=h,h=m;o=o+h&4294967295,p=p+i&4294967295,q=q+j&4294967295,r=r+k&4294967295,s=s+l&4294967295}var m=c(o)+c(p)+c(q)+c(r)+c(s);return m.toLowerCase()}c.ck=localStorage.getItem("runabove-ck");var p={login:f,logout:g,isLogged:k,getSchema:i,getModels:j};return angular.forEach(["get","put","post","delete","remove","del"],function(a){p[a]=function(b,c){return h(angular.extend(c||{},{method:("remove"===a||"del"===a?"delete":a).toUpperCase(),url:b}))}}),p}]});